<nav class="navbar navbar-expand-lg navbar-dark bg-dark py-0">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Lemuria</a>
    <div *ngIf="debug" class="badge bg-danger">
      DEBUG - {{strFps}}<br/>
      {{strMem}}
    </div>
    <div class="nav navbar-nav">
      <div class="btn-group me-1" dropdown [isDisabled]="worldSvc.worldList.length === 0">
        <div dropdownToggle type="button" class="btn btn-dark text-green" title="Worlds">
          <fa-icon [icon]="faGlobe" [fixedWidth]="true"/>
        </div>
        <ul *dropdownMenu class="dropdown-menu" role="menu">
          <li *ngFor="let w of worldSvc.worldList" role="menuitem" (click)="teleportWorld(w.name)">
            <button class="dropdown-item">
              <fa-icon [icon]="faGlobe"/> {{ w.name }}
              <span class="badge rounded-pill bg-secondary float-end">{{ w.users }}</span>
            </button>
          </li>
        </ul>
      </div>
      <div class="btn-group me-1" dropdown>
        <div dropdownToggle type="button" class="btn btn-dark text-gray" title="Options">
          <fa-icon [icon]="faCog" [fixedWidth]="true"/>
        </div>
        <ul *dropdownMenu class="dropdown-menu" role="menu">
          <li role="menuitem" (click)="openSettings()">
            <button class="dropdown-item">
              <fa-icon [icon]="faCog"/> Settings...
            </button>
          </li>
          <li role="menuitem" (click)="openControls()">
            <button class="dropdown-item">
              <fa-icon [icon]="faKeyboard"/> Controls...
            </button>
          </li>
          <li role="menuitem" (click)="openWorldAttribs()">
            <button class="dropdown-item">
              <fa-icon [icon]="faGlobe"/> World features...
            </button>
          </li>
        </ul>
      </div>
      <div class="btn-group me-1" dropdown [isDisabled]="!socket.connected">
        <button dropdownToggle class="btn btn-dark text-orange" title="Avatar" [disabled]="!socket.connected">
          <fa-icon [icon]="faCircleUser" [fixedWidth]="true"/>
        </button>
        <ul *dropdownMenu class="dropdown-menu" role="menu">
          <li role="menuitem" *ngFor="let a of worldSvc.avatarList; let index = index" (click)="changeAvatar(index)">
            <button class="dropdown-item">
              <fa-icon [class.invisible]="index !== avatarId" [icon]="faCheck"/> {{ a.name }}
            </button>
          </li>
        </ul>
      </div>
      <div class="btn-group me-1" dropdown [isDisabled]="!socket.connected">
        <button dropdownToggle class="btn btn-dark text-blue" title="Visibility" [disabled]="!socket.connected">
          <fa-icon [icon]="faMountainSun" [fixedWidth]="true"/>
        </button>
        <ul *dropdownMenu class="dropdown-menu" role="menu">
          <li role="menuitem" *ngFor="let v of visibilityList" (click)="changeVisibility(v)">
            <button class="dropdown-item">
              <fa-icon [class.invisible]="v !== visibility" [icon]="faCheck"/> {{ v }} meters
            </button>
          </li>
        </ul>
      </div>
      <button [ngSwitch]="cameraType" class="btn btn-dark text-indigo me-1" title="Toggle camera" (click)="toggleCamera()" type="button">
        <fa-icon *ngSwitchCase="0" [icon]="faEye" [fixedWidth]="true"/>
        <fa-icon *ngSwitchCase="1" [icon]="faVideo" [fixedWidth]="true"/>
        <fa-icon *ngSwitchCase="2" [icon]="faPerson" [fixedWidth]="true"/>
      </button>
    </div>
    <div class="my-2 my-sm-0">
      <div class="btn-group me-1" dropdown>
        <button dropdownToggle class="btn btn-dark text-yellow" title="Teleport">
          <fa-icon [icon]="faBolt" [fixedWidth]="true"/>
        </button>
        <ul *dropdownMenu class="dropdown-menu" role="menu">
          <li role="menuitem" (click)="openTeleport(0)">
            <button class="dropdown-item">
              <fa-icon [icon]="faBolt"/> To...
            </button>
          </li>
          <li role="menuitem" (click)="openTeleport(1)">
            <button class="dropdown-item" [disabled]="!socket.connected">
              <fa-icon [icon]="faBolt"/> Remember...
            </button>
          </li>
          <li *ngIf="teleports().length" class="divider dropdown-divider"></li>
          <li *ngFor="let t of teleports()" role="menuitem"
              (click)="teleportSvc.teleport.set({world: t.world, position: t.position, isNew: true})">
            <button class="dropdown-item">
              <fa-icon [icon]="faBolt"/> {{t.name}}
            </button>
          </li>
        </ul>
      </div>
      <button class="btn btn-dark text-teal me-1" type="button" title="Home"
              (click)="teleportSvc.teleport.set(home)" [disabled]="!home.world && !home.position">
        <fa-icon [icon]="faHouse" [fixedWidth]="true"/>
      </button>
      <button class="btn btn-dark text-cyan" type="button" title="Teleport Back"
              (click)="teleportSvc.teleportBack()" [disabled]="teleportSvc.currentTeleportIndex <= 0">
        <fa-icon [icon]="faArrowLeft" [fixedWidth]="true"/>
      </button>
      <button class="btn btn-dark text-cyan me-1" type="button" title="Teleport Forward"
              (click)="teleportSvc.teleportNext()" [disabled]="teleportSvc.currentTeleportIndex >= teleportSvc.teleportHistory.length - 1">
        <fa-icon [icon]="faArrowRight" [fixedWidth]="true"/>
      </button>
      <div class="btn-group" dropdown [isDisabled]="worldSvc.gestures().size === 0">
        <button dropdownToggle class="btn btn-dark text-pink" title="Gestures" [disabled]="worldSvc.gestures().size === 0">
          <fa-icon [icon]="faHand" [fixedWidth]="true" transform="rotate-30"/>
        </button>
        <ul *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu">
          <li *ngFor="let a of worldSvc.gestures() | keyvalue" role="menuitem" class="dropdown-item" (click)="setAnimation(a.key)">
            {{a.key}}
          </li>
        </ul>
      </div>
    </div>
    <div class="text-center text-light lh-1">
      {{strPos}}<br />
      {{strAlt}}m
    </div>
    <button class="d-inline-block btn btn-dark btn-circle" (click)="compassClick(true)" (contextmenu)="compassClick(false)" type="button">
      <div #compass>
        <fa-layers [fixedWidth]="true">
          <fa-icon class="d-inline-block" [icon]="faLocationArrow" transform="rotate-135 down-5"/>
          <fa-icon class="d-inline-block" [icon]="faLocationArrow" class="text-danger" transform="rotate-315 up-4"/>
          <fa-layers-text content="N" class="text-warning" transform="shrink-5 up-16"/>
          <fa-layers-text content="E" class="text-warning" transform="rotate-90 shrink-5 right-16"/>
          <fa-layers-text content="S" class="text-warning" transform="rotate-180 shrink-5 down-17"/>
          <fa-layers-text content="W" class="text-warning" transform="rotate-270 shrink-5 left-16"/>
        </fa-layers>
      </div>
    </button>
    <div class="nav navbar-nav ml-auto">
      <div class="btn-group" dropdown [isDisabled]="userList.length === 0">
        <button dropdownToggle class="btn btn-dark text-purple" title="Users">
          <fa-icon [icon]="faUsers" [fixedWidth]="true"/> {{ userList.length }}
        </button>
        <ul *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu">
          <li *ngFor="let u of userList" role="menuitem" class="dropdown-item">
            <fa-icon [icon]="faUser"/>
            {{u.name}}
            <button *ngIf="u.id !== userId && u.world === worldSvc.worldId" class="btn btn-sm btn-warning"
                    (click)="joinUser(u.id)" type="button" title="Join user">
              <fa-icon [icon]="faBolt"/>
            </button>
          </li>
        </ul>
      </div>
      <div class="btn-group ms-1" dropdown>
        <button dropdownToggle class="btn btn-dark text-red" title="Leave">
          <fa-icon [icon]="faRightFromBracket" [fixedWidth]="true"/>
        </button>
        <ul *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu">
          <li *ngIf="socket.connected" role="menuitem" (click)="socket.close()">
            <button class="dropdown-item"><fa-icon [icon]="faRightFromBracket"/> Leave world</button>
          </li>
          <li role="menuitem" (click)="logout()">
            <button class="dropdown-item"><fa-icon [icon]="faRightFromBracket"/> Sign out</button>
          </li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<ng-template #settingsModal>
  <app-ui-settings (closeModal)="closeSettings()"/>
</ng-template>
<ng-template #controlsModal>
  <app-ui-controls (closeModal)="closeControls()"/>
</ng-template>
<ng-template #teleportModal>
  <app-ui-teleport [type]="teleportType" (closeModal)="closeTeleport()"/>
</ng-template>
<ng-template #worldAttribsModal>
  <app-ui-world-attribs (closeModal)="closeWorldAttribs()"/>
</ng-template>